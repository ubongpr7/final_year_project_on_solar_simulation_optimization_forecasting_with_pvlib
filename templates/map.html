
{% load static %}

{% load bootstrap5 %}
<!-- templates/map.html -->

    <style>
        #map {
            width: 60%;
            height: 300px;
        }
    </style>
    
{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}
<script src="https://unpkg.com/htmx.org@1.9.2"></script>

    <h1>Search Address on Map</h1>
    <form hx-post="{% url 'map' %}" hx-target="#map-container" hx-trigger="submit" hx-swap="post">
        {% csrf_token %}
        {% bootstrap_form form %}
        <div class="mb-3">
            <select id="address-select" name="address" class="form-select" size="5"
                    onchange="document.getElementById('address-input').value=this.value;">
                <!-- Options will be populated here -->
            </select>
        </div>

        <div id="loading-indicator" class="spinner-border text-primary" role="status" style="display: none;">
            <span class="visually-hidden">Loading...</span>
        </div>

        {% buttons %}
        <button type="submit" class="btn btn-primary">
          Submit
        </button>
      {% endbuttons %}


    </form>


    <script>
        document.getElementById('address-input').addEventListener('input', function() {
            var select = document.getElementById('address-select');
            if (this.value.length > 0) {
                select.style.display = 'block';
            } 
            
        });
    </script>
    <div id="map">
        {{ map|safe }}
    </div>

    <script>
        // Assuming you have a way to get the lat, lon, and tz from the map
        function updateParentFields(lat, lon, tz) {
            const latField = document.getElementById('id_lat');
            const lonField = document.getElementById('id_lon');
            const tzField = document.getElementById('id_tz');
            
            latField.value = lat;
            lonField.value = lon;
            tzField.value = tz;
        }
    </script>    